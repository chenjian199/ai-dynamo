#!/usr/bin/env python3
"""
åˆ†æDynamoGraphDeploymenté…ç½®æ–‡ä»¶ä¸­æœªæ˜ç¡®è®¾ç½®çš„å‚æ•°çš„é»˜è®¤å€¼
"""

def analyze_default_values():
    """åˆ†æé»˜è®¤å€¼é…ç½®"""
    
    print("ğŸ” DynamoGraphDeployment é»˜è®¤å€¼åˆ†æ")
    print("=" * 60)
    print()
    
    print("ğŸ“‹ é…ç½®æ–‡ä»¶åˆ†æ (ä»¥ agg.yaml ä¸ºä¾‹):")
    print("-" * 50)
    print()
    
    print("ğŸ”¹ å·²æ˜ç¡®è®¾ç½®çš„å‚æ•°:")
    print("   âœ… GPU: limits.gpu = '1'")
    print("   âœ… é•œåƒ: nvcr.io/nvidia/ai-dynamo/vllm-runtime:0.5.0")
    print("   âœ… å‰¯æœ¬æ•°: replicas = 8")
    print("   âœ… å·¥ä½œç›®å½•: /workspace/components/backends/vllm")
    print("   âœ… æ¨¡å‹è·¯å¾„: /shared-models/DeepSeek/DeepSeek-R1-Distill-Qwen-7B")
    print()
    
    print("ğŸ”¹ æœªæ˜ç¡®è®¾ç½®çš„å‚æ•° (ä½¿ç”¨é»˜è®¤å€¼):")
    print("   âŒ CPU requests/limits")
    print("   âŒ Memory requests/limits")
    print("   âŒ vLLM å‚æ•°")
    print("   âŒ ç¯å¢ƒå˜é‡")
    print("   âŒ å¥åº·æ£€æŸ¥")
    print()
    
    print("ğŸ¯ 1. Kubernetes èµ„æºé»˜è®¤å€¼:")
    print("=" * 40)
    print()
    
    print("ğŸ“Š CPU èµ„æº:")
    print("   ğŸ”¸ requests: æ— é»˜è®¤å€¼ (Kubernetesä¸è®¾ç½®)")
    print("   ğŸ”¸ limits: æ— é»˜è®¤å€¼ (Kubernetesä¸è®¾ç½®)")
    print("   ğŸ”¸ å®é™…è¡Œä¸º: Podå¯ä»¥ä½¿ç”¨èŠ‚ç‚¹ä¸Šæ‰€æœ‰å¯ç”¨çš„CPU")
    print("   ğŸ”¸ é£é™©: å¯èƒ½å¯¼è‡´CPUèµ„æºç«äº‰")
    print()
    
    print("ğŸ’¾ Memory èµ„æº:")
    print("   ğŸ”¸ requests: æ— é»˜è®¤å€¼ (Kubernetesä¸è®¾ç½®)")
    print("   ğŸ”¸ limits: æ— é»˜è®¤å€¼ (Kubernetesä¸è®¾ç½®)")
    print("   ğŸ”¸ å®é™…è¡Œä¸º: Podå¯ä»¥ä½¿ç”¨èŠ‚ç‚¹ä¸Šæ‰€æœ‰å¯ç”¨çš„å†…å­˜")
    print("   ğŸ”¸ é£é™©: å¯èƒ½å¯¼è‡´OOM (Out of Memory)")
    print()
    
    print("ğŸ® GPU èµ„æº:")
    print("   ğŸ”¸ requests: æ— é»˜è®¤å€¼ (Kubernetesä¸è®¾ç½®)")
    print("   ğŸ”¸ limits: å·²è®¾ç½®ä¸º '1'")
    print("   ğŸ”¸ å®é™…è¡Œä¸º: æ¯ä¸ªPodåˆ†é…1ä¸ªGPU")
    print()
    
    print("ğŸ”§ 2. vLLM å‚æ•°é»˜è®¤å€¼:")
    print("=" * 30)
    print()
    
    print("ğŸ“ˆ GPU å†…å­˜ç®¡ç†:")
    print("   ğŸ”¸ --gpu-memory-utilization: é»˜è®¤ 0.9 (90%)")
    print("   ğŸ”¸ --max-model-len: é»˜è®¤ 2048 tokens")
    print("   ğŸ”¸ --max-num-seqs: é»˜è®¤ 256")
    print("   ğŸ”¸ --enforce-eager: é»˜è®¤ False (ä½¿ç”¨CUDA graphs)")
    print()
    
    print("âš¡ æ€§èƒ½å‚æ•°:")
    print("   ğŸ”¸ --disable-log-requests: é»˜è®¤ False (å¯ç”¨æ—¥å¿—)")
    print("   ğŸ”¸ --tensor-parallel-size: é»˜è®¤ 1")
    print("   ğŸ”¸ --pipeline-parallel-size: é»˜è®¤ 1")
    print("   ğŸ”¸ --block-size: é»˜è®¤ 16")
    print()
    
    print("ğŸ”„ è°ƒåº¦å‚æ•°:")
    print("   ğŸ”¸ --scheduler-policy: é»˜è®¤ 'fcfs' (First Come First Serve)")
    print("   ğŸ”¸ --max-num-batched-tokens: é»˜è®¤ 2048")
    print("   ğŸ”¸ --max-num-seqs: é»˜è®¤ 256")
    print()
    
    print("ğŸŒ 3. Dynamo ç¯å¢ƒå˜é‡é»˜è®¤å€¼:")
    print("=" * 40)
    print()
    
    print("ğŸ“¡ ç½‘ç»œé…ç½®:")
    print("   ğŸ”¸ DYN_NAMESPACE: é»˜è®¤ 'dynamo-{deployment-name}'")
    print("   ğŸ”¸ DYN_SYSTEM_PORT: é»˜è®¤ 9090")
    print("   ğŸ”¸ DYN_HTTP_PORT: é»˜è®¤ 8000")
    print("   ğŸ”¸ DYN_SYSTEM_ENABLED: é»˜è®¤ 'true' (worker)")
    print()
    
    print("ğŸ”§ ç³»ç»Ÿé…ç½®:")
    print("   ğŸ”¸ HF_HUB_OFFLINE: é»˜è®¤ '0' (åœ¨çº¿æ¨¡å¼)")
    print("   ğŸ”¸ TRANSFORMERS_OFFLINE: é»˜è®¤ '0' (åœ¨çº¿æ¨¡å¼)")
    print("   ğŸ”¸ CUDA_VISIBLE_DEVICES: é»˜è®¤æ‰€æœ‰GPUå¯è§")
    print()
    
    print("ğŸ“Š 4. å¥åº·æ£€æŸ¥é»˜è®¤å€¼:")
    print("=" * 30)
    print()
    
    print("ğŸ¥ æ¢é’ˆé…ç½®:")
    print("   ğŸ”¸ readinessProbe: æ— é»˜è®¤å€¼")
    print("   ğŸ”¸ livenessProbe: æ— é»˜è®¤å€¼")
    print("   ğŸ”¸ startupProbe: æ— é»˜è®¤å€¼")
    print("   ğŸ”¸ å®é™…è¡Œä¸º: ä¾èµ–å®¹å™¨å†…éƒ¨å¥åº·æ£€æŸ¥")
    print()
    
    print("â±ï¸ è¶…æ—¶è®¾ç½®:")
    print("   ğŸ”¸ initialDelaySeconds: æ— é»˜è®¤å€¼")
    print("   ğŸ”¸ periodSeconds: æ— é»˜è®¤å€¼")
    print("   ğŸ”¸ timeoutSeconds: æ— é»˜è®¤å€¼")
    print("   ğŸ”¸ failureThreshold: æ— é»˜è®¤å€¼")
    print()
    
    print("ğŸ”§ 5. å­˜å‚¨å’Œå·é»˜è®¤å€¼:")
    print("=" * 30)
    print()
    
    print("ğŸ’¾ å­˜å‚¨é…ç½®:")
    print("   ğŸ”¸ volumeMounts: æ— é»˜è®¤å€¼")
    print("   ğŸ”¸ volumes: æ— é»˜è®¤å€¼")
    print("   ğŸ”¸ persistentVolumeClaim: æ— é»˜è®¤å€¼")
    print("   ğŸ”¸ å®é™…è¡Œä¸º: ä½¿ç”¨å®¹å™¨å†…æ–‡ä»¶ç³»ç»Ÿ")
    print()
    
    print("ğŸ“ å·¥ä½œç›®å½•:")
    print("   ğŸ”¸ workingDir: å·²è®¾ç½®ä¸º '/workspace/components/backends/vllm'")
    print("   ğŸ”¸ é»˜è®¤è¡Œä¸º: ä½¿ç”¨å®¹å™¨é•œåƒçš„é»˜è®¤å·¥ä½œç›®å½•")
    print()
    
    print("ğŸ¯ 6. é…ç½®å¯¹æ¯”åˆ†æ:")
    print("=" * 30)
    print()
    
    print("ğŸ“Š ä¸åŒé…ç½®æ–‡ä»¶çš„èµ„æºè®¾ç½®å¯¹æ¯”:")
    print("â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”")
    print("â”‚ é…ç½®æ–‡ä»¶            â”‚ CPU      â”‚ Memory   â”‚ GPU      â”‚ ç‰¹æ®Šé…ç½® â”‚")
    print("â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤")
    print("â”‚ agg.yaml            â”‚ æœªè®¾ç½®   â”‚ æœªè®¾ç½®   â”‚ limits=1 â”‚ æ—        â”‚")
    print("â”‚ agg_kvbm.yaml       â”‚ æœªè®¾ç½®   â”‚ 200-250Giâ”‚ limits=1 â”‚ KVBM     â”‚")
    print("â”‚ disagg_kvbm.yaml    â”‚ æœªè®¾ç½®   â”‚ 200-250Giâ”‚ limits=1 â”‚ KVBM     â”‚")
    print("â”‚ disagg_optimized... â”‚ æœªè®¾ç½®   â”‚ æœªè®¾ç½®   â”‚ limits=1 â”‚ ä¼˜åŒ–é…ç½® â”‚")
    print("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜")
    print()
    
    print("âš ï¸ 7. æ½œåœ¨é£é™©åˆ†æ:")
    print("=" * 30)
    print()
    
    print("ğŸš¨ èµ„æºç«äº‰é£é™©:")
    print("   ğŸ”¸ CPUæœªé™åˆ¶: å¯èƒ½å¯¼è‡´CPUèµ„æºç«äº‰")
    print("   ğŸ”¸ Memoryæœªé™åˆ¶: å¯èƒ½å¯¼è‡´OOMé”™è¯¯")
    print("   ğŸ”¸ å¤šä¸ªPodå¯èƒ½äº‰å¤ºåŒä¸€èµ„æº")
    print()
    
    print("ğŸ“ˆ æ€§èƒ½é£é™©:")
    print("   ğŸ”¸ vLLMå‚æ•°ä½¿ç”¨é»˜è®¤å€¼å¯èƒ½ä¸é€‚åˆç”Ÿäº§ç¯å¢ƒ")
    print("   ğŸ”¸ GPUå†…å­˜åˆ©ç”¨ç‡90%å¯èƒ½è¿‡é«˜")
    print("   ğŸ”¸ ç¼ºå°‘å¥åº·æ£€æŸ¥å¯èƒ½å¯¼è‡´æœåŠ¡ä¸å¯ç”¨")
    print()
    
    print("ğŸ”§ 8. æ¨èé…ç½®:")
    print("=" * 20)
    print()
    
    print("ğŸ“‹ å®Œæ•´çš„èµ„æºé…ç½®ç¤ºä¾‹:")
    print("   ```yaml")
    print("   resources:")
    print("     requests:")
    print("       cpu: '4'")
    print("       memory: '16Gi'")
    print("       gpu: '1'")
    print("     limits:")
    print("       cpu: '8'")
    print("       memory: '32Gi'")
    print("       gpu: '1'")
    print("   ```")
    print()
    
    print("ğŸ¥ å¥åº·æ£€æŸ¥é…ç½®ç¤ºä¾‹:")
    print("   ```yaml")
    print("   readinessProbe:")
    print("     httpGet:")
    print("       path: /health")
    print("       port: 8000")
    print("     initialDelaySeconds: 30")
    print("     periodSeconds: 10")
    print("     timeoutSeconds: 5")
    print("     failureThreshold: 3")
    print("   ```")
    print()
    
    print("âš¡ vLLMä¼˜åŒ–å‚æ•°ç¤ºä¾‹:")
    print("   ```yaml")
    print("   args:")
    print("     - --gpu-memory-utilization")
    print("     - '0.8'  # 80% GPUå†…å­˜")
    print("     - --max-model-len")
    print("     - '32000'  # æ”¯æŒé•¿åºåˆ—")
    print("     - --max-num-seqs")
    print("     - '128'  # é€‚ä¸­çš„å¹¶å‘æ•°")
    print("     - --disable-log-requests  # å‡å°‘æ—¥å¿—å¼€é”€")
    print("   ```")
    print()
    
    print("ğŸ¯ 9. æœ€ä½³å®è·µå»ºè®®:")
    print("=" * 30)
    print()
    
    print("âœ… èµ„æºç®¡ç†:")
    print("   1. å§‹ç»ˆè®¾ç½®CPUå’ŒMemoryçš„requestså’Œlimits")
    print("   2. æ ¹æ®æ¨¡å‹å¤§å°å’Œå¹¶å‘æ•°è°ƒæ•´èµ„æºåˆ†é…")
    print("   3. ç›‘æ§èµ„æºä½¿ç”¨æƒ…å†µå¹¶ä¼˜åŒ–é…ç½®")
    print()
    
    print("âœ… æ€§èƒ½ä¼˜åŒ–:")
    print("   1. æ ¹æ®å·¥ä½œè´Ÿè½½è°ƒæ•´vLLMå‚æ•°")
    print("   2. å¯ç”¨é€‚å½“çš„å¥åº·æ£€æŸ¥")
    print("   3. é…ç½®åˆé€‚çš„æ—¥å¿—çº§åˆ«")
    print()
    
    print("âœ… ç”Ÿäº§ç¯å¢ƒ:")
    print("   1. ä½¿ç”¨èµ„æºé™åˆ¶é˜²æ­¢èµ„æºç«äº‰")
    print("   2. é…ç½®å¥åº·æ£€æŸ¥å’Œè‡ªåŠ¨é‡å¯")
    print("   3. ç›‘æ§å’Œå‘Šè­¦ç³»ç»Ÿ")
    print()
    
    print("ğŸ¯ æ€»ç»“:")
    print("=" * 10)
    print()
    print("âœ… æœªè®¾ç½®çš„å‚æ•°ä¼šä½¿ç”¨ç³»ç»Ÿé»˜è®¤å€¼")
    print("âœ… Kubernetesä¸è®¾ç½®èµ„æºé™åˆ¶çš„é»˜è®¤å€¼")
    print("âœ… vLLMæœ‰åˆç†çš„é»˜è®¤å‚æ•°")
    print("âœ… Dynamoæœ‰é»˜è®¤çš„ç¯å¢ƒå˜é‡")
    print("âš ï¸ ç”Ÿäº§ç¯å¢ƒå»ºè®®æ˜ç¡®è®¾ç½®æ‰€æœ‰å…³é”®å‚æ•°")
    print("âš ï¸ èµ„æºé™åˆ¶å¯¹ç¨³å®šæ€§å’Œæ€§èƒ½å¾ˆé‡è¦")
    print()
    print("ğŸ’¡ å…³é”®å»ºè®®:")
    print("   - æ˜ç¡®è®¾ç½®CPUå’ŒMemoryèµ„æºé™åˆ¶")
    print("   - æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´vLLMå‚æ•°")
    print("   - é…ç½®å¥åº·æ£€æŸ¥ç¡®ä¿æœåŠ¡å¯ç”¨æ€§")
    print("   - ç›‘æ§èµ„æºä½¿ç”¨æƒ…å†µ")

if __name__ == "__main__":
    analyze_default_values()
